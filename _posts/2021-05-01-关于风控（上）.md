---
layout: post
title: 关于风控（上）
summary: 关键词：风控概念、黑产概述、规则引擎
featured-img: shane-rounce-205187
---
### 风控概念

风控是相当广泛的概念，从金融信贷，到电商，支付，游戏，社区......不同业务场景下都各自积累出一套基于自身业务的风控理解。我们常见的一些概念，如：反欺诈、反作弊、信贷管控、内容安全、社区治理、电商治理、平台治理、移动安全、WEB安全、账号安全等，都可以纳入风控范畴。

传统金融信贷是风控概念的源起。用户申请贷款，平台审核信用确定是否放贷及对应额度。贷前审核就是风险控制的过程。风险控制不利将直接影响坏账率从而扩大平台资损。信贷关注坏账率同时也关注放贷量，因而其风控策略要求有强解释性，因此在早期风控策略中评分卡模型大量被应用。

电商和 O2O 主要是构造双边市场，平台通过撮合双边交易来获取商业回报，对应的风控其实就是平台治理。平台治理一方面关注供给侧，典型如商户的刷单、炒信、虚假商品服务等行为，另一方面关注消费侧，主要是营销反作弊，也就是薅羊毛。商品服务过程中用户和商家会产生纠纷，典型如滴滴的司乘纠纷，纠纷处理往往也会纳入平台治理范畴。

知乎、小红书是以内容为主的社区产品，内容生产、分发和消费是其产品核心主线。发布内容是否符合国家相关法律法规，平台需要承担主体责任，这一规定使得内容安全成为社区风控的重中之重。内容安全之上，内容是否符合平台自身的社区调性也需要治理把控，不过这一般不纳入风控范畴而归属于社区内容运营。

探探、陌陌是典型的陌生人社交产品，用户在平台内与其他用户建立联系进而发展成稳固的社交关系，平台则基于社交关系开展增值付费业务。社交关系的快速建立也使得黑产能够快速接触潜在用户，陌生人社交的风控问题主要为诈骗和导流，常见的如杀猪盘、狗推等。

除上述业务自身特有的风控场景外，APP客户端自身的安全、用户账号的安全等也需要关注，常见的如拖库、撞库，风控缺少管控可能会造成用户数据泄露。

### 黑灰产概述

黑灰产是成熟的产业链，有上下游分工、专业生产工具、体系化人员培训等。想更好了解黑灰产，不妨先假设自己要做一个工作室。

成立黑灰产第一步需要准备以下物料：手机号、移动设备、网络、银行卡、身份证等。这些物料构成了作案的基础生产工具。

为了能够快速给下游提供工具，黑灰产形成了细分的产业链条，比如：

- 接码平台：提供手机号及验证码接收服务；
- 群控工具：将多台手机设备集成到 PC 端统一去管理，提高整体操控效率；
- 代理IP池：提供大量备用IP支持随机切换，用于避开IP黑名单和频控限制策略；
- 改机工具：通过技术手段修改设备信息，绕过设备纬度的防控策略；

获取基础工具后，可以选择细分的业务方向进行获利，比如：

- 虚假流量：批量注册账号用于刷赞、刷点击、刷评论、刷粉等；
- 薅羊毛：以新用户的身份获取平台折扣、返现、抽奖、满减等权益；
- 刷单炒信：通过虚假订单来提高商户的交易量、评分和信用等级等；
- 杀猪盘：诱骗他人投资赌博进行诈骗；
- 狗推：给博彩网站引流；
- 导流：给黑五类产品导流赚取佣金；

大多数黑灰产不会只开展一个业务，账号在存活周期内会开展多种黑灰产行为。平台根据风险情报和已知case设计风控策略，黑灰产也同时升级作案方式，风控业务的典型特点是始终处在对抗状态。


### 规则引擎

风控的强对抗性要求策略能够快速更新迭代，因此规则引擎是非常重要的产品模块。规则引擎在设计上解耦了策略逻辑和业务代码，从而做到策略的快速部署上线。同时，规则引擎前端大多以可视化样式来支持运营自主配置，降低了配置成本并将配置主体由研发转移到了产运。

了解规则引擎前可以先了解策略。假设有营销活动规定：未满18岁的男性不得领优惠券。针对该策略，用伪代码形式可表述为：当 用户领券 时，如果 用户年龄 小于 18岁，且 用户性别 等于 男性，则 拒绝领券；

对策略解构，可以得到如下元素：

- Event：事件，描述策略的执行时机；实时策略对应实时用户行为，离线策略事件可以理解是定时器；
- Rules：规则，由多个表达式组成，规则判断是在对其做布尔判断；
- Action：动作，规则判断后系统关联的执行动作；

规则是策略逻辑的主体部分，一般由多个表达式组成：

- 单个表达式包括左变量、右变量、运算符三部分；
- 习惯上将左变量理解为用户特征，右变量设为具体值；
- 运算符连接左右变量，可分为比较运算符和关系运算符；
- 比较运算符：大于、大于等于、等于、不等于、小于、小于等于；
- 关系运算符：在...中、不在...中；
- 多个条件表达式间的逻辑关系由逻辑运算符AND、OR表达；

策略判断一方面依赖语法解析，另一方面需要获取策略中所引用的全部数据。

规则引擎引用的数据一般会提前预处理以提高整体执行效率。负责定义和预处理数据的模块称为特征中心。特征中心的产品定位为提供统一的特征数据查询、存储和管理服务。特征数据根据来源，可简单分为三类：用户画像类、行为频次类、模型分。

- 用户画像类：用户静态的画像数据；
- 行为频次类：行为事件在某个时间窗口内的频次统计；
- 模型分：对应模型的分值；

用户画像类数据是用户的基础数据，典型如：用户年龄、性别、手机号、登录IP、设备名称、使用APP版本、网络类型等。画像数据也可以结合用户行为区分，比如手机号可区分注册手机号和最近登录手机号，其注册数据持久不变，登录数据可根据用户行为动态更新。

行为频次类主要统计某个行为事件在某个时间窗口内统计。时间窗口可以是固定的，比如“视频点赞量”，统计的是视频发出到当前时刻的所有点赞数量；也可以是滑动的，比如“最近30min下单数”，统计的是当前时刻前30min内的下单次数。

除特征中心数据外，触发事件本身也会携带数据。比如用户私聊事件，私聊内容会存在事件消息体中，此类数据做成特征显然是不合适的。因此，规则引擎也需要支持获取事件流中的数据。产品设计上会有事件管理模块，用于定义和管理事件及事件流中数据字段的业务语义。

获取规则中引用的数据并能正确执行规则文件的语法，剩下的就是规则引擎的前端可视化。

很多产品经理会对可视化有执念，能够配置的就不想写代码，能够点选的就不想去输入，这在用户体验上没有问题。但考虑平台演进路线，做什么东西自然重要，但在什么时候去做有时候会更重要。

从0到1搭建规则引擎是一项工作量很大的事情。规则引擎上游需要构建事件和特征服务，自身需要构建语法规范，下游与处罚中心交互。同时在架构上要支撑数据的高吞吐，保证平台的稳定性。整个建设环节中，有非常多的边界和细节需要去处理，如果一开始就大力追求可视化，容易在早期消耗掉核心资源造成技术欠账，从而会影响后续的迭代效率。

### 风控策略

业务的风控策略属于敏感信息，了解策略也就知道了如何绕过策略。策略的设计和黑灰产的行为路径关联，比如：
- 手机号：
- 设备：黑产为控制成本，群控手机价格一般较低，常见的高危设备如 Redmi系列；
- IP：
- APP版本：某些低版本 APP 因为设计漏洞可能会有黑产聚集；
- 黑灰产手机号从接码平台获取，网络使用代理IP池，手机号归属地和IP归属地大多不一致；




