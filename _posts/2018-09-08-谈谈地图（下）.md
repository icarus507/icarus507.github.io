---
layout: post
title: 谈谈地图（下）
summary: 关键词：定位、POI、导航、开放平台
featured-img: ruben-santander-69158
---
### 关于定位


非导航类APP对地图服务的应用主要集中在定位和POI数据上。定位主要通过GPS实现，但也有其他方法来补充，比如基于基站，基于WIFI信号，基于地磁信息的等等。

GPS的原理相对简单，卫星和移动终端各自内置一个同步时钟，然后终端接收卫星的信号并根据时延计算出距离。当获取到三颗卫星的距离并已知各卫星的位置坐标，是可以计算出目的点的坐标的。GPS的定位精度可以控制在20米以内，适用范围也相对较广，但也存在两个问题：耗电和室内场景不适用。

GPS初次接受卫星信号的时候会比较耗电，比如你从北京出差去深圳，如此远距离的移动可能导致之前连接的卫星发生变更，需要重新连接，这个时候就会比较耗电。另外，由于在室内经常会存在接受不到卫星信号的情况，室内定位一般不会依赖GPS。

考虑上述GPS定位的局限，一般会采用基站定位和WIFI定位来补充。二者的原理和GPS定位的原理一致，只是将卫星替换成了运营商的基站和WIFI的信号源。目前室内定位的解决方案大多是基于wifi的，部分还会通过低功耗蓝牙以及地磁信息做补充。

与定位另一个相关联的概念是“地理围栏”。

很多公司会要求员工在上班时候用钉钉在公司打卡，这个打卡实质上就是要判断用户当前的定位信息是否在某一个地理区域范围内。这个地理区域范围就是地理围栏的概念。


### 关于POI

目前能看到的社交、社区、电商、020等产品，基本都支持POI信息的查看和分享，比如微信发布朋友圈时，首位可选配置项即为“所在位置”，大众点评APP，低栏第二位tab便为“地图”。

内容生产和内容消费场景下，地理位置的分享扩充了内容本身的语义；社交场景下，地理位置信息增加了用户的社交意愿；游戏（如阴阳师）也会将线下POI设定为道场，鼓励玩家线下建立协作联系，以期增加长期粘性。

POI是线下地理信息的线上抽象，也构建了一种线上到线下的流量通道，无论在需求满足还是在商业化潜质上，都是非常重要的服务能力。

POI的分类有很多，参考腾讯位置开放平台的[POI分类表](https://lbs.qq.com/service/webService/webServiceGuide/webServiceAppendix)，以第三级的tag为最小标签，其分类可达四百多种。不同分类下的POI会有不同纬度的详情信息。

百度地图18年内容生态的重点建设方向就是POI的详情数据，内部称为「高精度POI知识图谱」。一个POI一般会有三个维度上的数据：
* 基础信息：POI实体的基础信息，如名称、坐标、地址、类别、来源等，一般是静态的并且持久化的；
* 动态信息：用户UGC以及POI关联的富文本数据，如用户评论、星级评分、内部图片等，像抖音这样的视频社区，可能还能关联一些探店上视频；
* 关系信息：POI通过语义或时空建立起来的关系，比如商场内的店铺和商场本身有亲子关系，麦当劳的不同店铺会同属一个品牌等；

在数据更新及维护层面，考虑到内容安全，对于政治敏感类的POI一般会有单独的库。比如很多地图软件会给POI打一个活动标签，类似于“踏青好去处”这样的tag，像这样的标签如果展示到 「南京大屠杀纪念馆」这样的POI上，就很容易引起 PR 问题。


在应用层面，除了在底图展示外，POI还有一个漏出时机是检索。检索过程中，将结构化的地址，比如X省X市X区XX路XX号，转化到经纬度坐标上，称为地理编码，反之则称为逆地理编码。检索POI会触发地理位置编码，通过检索关键词，匹配一个或多个POI数据，再根据POI数据关联其地址，再将地理位置转化为经纬度坐标，最后对应到图区上进行展示。

POI检索场景下，召回POI点距离用户当前距离是一个非常重要的因素，这和信息的检索有很大不同。POI的「检索」往往是「到达」的一个前置表达，在所有的地图APP里，用户检索完占比最大的动作就是发起导航。


### 关于导航

导航是地图能力最核心的体现。导航一般会分为两个步骤：路线规划和实时导航。

路线规划本身是一个函数求解过程，已知起点位置和终点位置，并且知道道路数据、当前路况数据、历史路况数据，求出最佳行驶路径以及行驶时间。在这个函数求解过程中，需要考虑道路长度、当前拥堵情况，未来拥堵情况等等，会涉及到非常多的算法逻辑。

百度外卖是从百度地图体系下孵化出来的业务，当年独立融资时，对外主打的点就是自身即时配送的高效履约能力，这一点自然离不开其在地图导航上的算法积累。然而后边外卖大战逐渐胶着，后边真正将配送优势发扬光大的反倒是美团外卖。

美团配送算法老大何仁清18年曾分享过美团即时配送的算法实践，感兴趣可以参考：《[机器学习在美团配送系统的实践：用技术还原真实世界](https://tech.meituan.com/2018/12/13/machine-learning-in-distribution-practice.html)》

路线规划之后是实时导航，实时导航下很关键的两个服务能力是：定位、诱导。定位需要确保用户行驶轨迹是否在原规划路线上，如偏离过多则会触发重新规划。诱导可分为语音诱导和图片诱导，“前方一百米路口左转”是语音诱导，，展示车道线示意的图片则是图片诱导。诱导的目的是提前暴露信息，确保用户能及时调整，保证行驶轨迹是按照规划路线进行。

所以，导航的两个过程，路线规划是计算最佳路径，实时导航则是保障最佳路径可以执行，二者的配合构成了整体的导航服务。


### 开放平台


大多数企业需要但又没有能力自行搭建地图数据及其关联服务，这就促进了开放平台的发展。

国内地理位置开放平台主要有百度、高德和腾讯，目前也只有这三家有成熟的地图数据可供使用。开放平台的主要服务包括：
* 地图
* 定位
* 检索
* 路线规划
* 导航

在上述服务中，开放平台会提供的具体方法有（以百度地图SDK为例）：
* 地图样式控制：控制图层数据的显隐及展示效果；
* 




注：本文于 2018-09-08 开始撰写，最后更新于 2021-05-17。
