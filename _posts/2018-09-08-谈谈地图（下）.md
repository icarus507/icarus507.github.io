---
layout: post
title: 谈谈地图（下）
summary: 关键词：定位、POI、导航、开放平台
featured-img: ruben-santander-69158
---
### 关于定位

非导航类APP对地图服务的应用主要是定位和POI数据。定位主要依赖终端设备，可以通过GPS计算，但也会采用其他方法补充，比如基于基站，基于WIFI信号，基于地磁信息的等等。

GPS原理相对简单，卫星和移动终端各自内置一个同步时钟，终端接收卫星信号并根据时延计算出距离。当计算出到三颗卫星的距离并已知各卫星的位置坐标，就可以计算出目标点坐标。GPS的定位精度可以控制在20米以内，适用范围也相对较广，但也有其存在的问题：耗电和室内场景不适用。

GPS初次接受卫星信号会比较耗电，比如从北京出差深圳，如此远距离的移动可能导致之前连接的卫星发生变更，需重新连接，而重连就会比较耗电。另外，由于在室内会存在接受不到卫星信号的情况，所以室内定位一般不依赖GPS。导航也是如此，车辆进入隧道后软件会提示GPS信号弱，此时后台也会由GPS导航切换为惯性导航来做临时补充。

为应对上述GPS的局限，工程层面会采用基站定位和WIFI定位来补充。二者的原理和GPS原理一致，只是将卫星替换成了运营商的基站和WIFI的信号源。目前室内定位的解决方案大多是基于wifi的，部分还会通过地磁信息做补充。

“定位”解决的问题是知道某台终端设备此时在现实世界的具体坐标，但这个坐标在应用层面往往需要判断语义，此时经常出现的概念是“地理围栏”。

“地理围栏”是对现实世界的某个具体区域赋予其业务含义。如公司会要求员工在办公楼内打卡，地推人员会在某个具体的商圈内铺设物料，此处的“办公楼”和“商圈”范围显然需提前定义好，这就是定义地理围栏的过程。


### 关于POI

POI是除了定位外另一个非常重要的地理元素应用。目前能看到的社交、社区、电商、020等产品，基本都支持POI信息的查看和分享，比如微信发布朋友圈时，首位可选配置项为“所在位置”，大众点评APP低栏第二位tab便为“地图”。

内容生产和内容消费场景下，地理位置的分享扩充了内容本身的语义；在社交场景下，“附近的人”增加了用户的社交意愿和拓展渠道；游戏（如阴阳师）也会将线下POI设定为道场，鼓励玩家线下建立协作联系，以期增加长期粘性。

POI是线下地理信息的线上抽象，同时也构建了一种线上到线下的流量通道，无论是在需求满足还是商业化潜质上，都是一个非常重要的能力。

POI的分类有很多，参考腾讯位置开放平台的 《[POI分类表](https://lbs.qq.com/service/webService/webServiceGuide/webServiceAppendix)》。以第三级的tag为最小标签，其分类可达四百多种，不同分类下的POI会有不同纬度的详情信息。

百度地图18年内容生态的重点建设方向就是POI的详情数据，内部称为「高精度POI知识图谱」。POI的详情信息可分为三个维度：

* 基础信息：POI实体的基础信息，如名称、坐标、地址、类别、来源等，一般是静态的并且持久化的；

* 动态信息：用户UGC以及POI关联的富文本数据，如用户评论、星级评分、内部图片等，像抖音这样的视频社区，可能还能关联一些探店视频；

* 关系信息：POI通过语义或时空建立起来的关系，比如商场内的店铺和商场本身有亲子关系，麦当劳的不同店铺会同属一个品牌等；

在数据更新及维护层面，考虑到内容安全，对于政治敏感类的POI一般会有单独的标记。比如很多地图软件会给POI打一个活动标签，类似于“踏青好去处”这样的tag，像这样的标签如果展示到 “南京大屠杀纪念馆“ 这样的POI上，就很容易引起PR问题。


应用层面上，除了在底图展示外，POI还有一个漏出时机是检索。将结构化的地址，比如X省X市X区XX路XX号，转化到经纬度坐标上，称为地理编码，反之则称为逆地理编码。检索POI会触发地理位置编码，通过检索关键词，匹配一个或多个POI数据，再根据POI数据关联其地址，再将地理位置转化为经纬度坐标，最后对应到图区上进行展示。

检索场景下，召回POI点距离用户所在点的距离是一个非常重要的信息，这和信息的检索有很大不同。POI的「检索」往往是「到达」的一个前置表达，在所有的地图APP里，用户检索完占比最大的动作就是发起导航。因此，POI的检索，在检索过程中往往也会指定检索的地理范围。


### 关于导航

导航是地图能力最核心的体现。导航一般会分为两个步骤：路线规划和实时导航。

路线规划本身是一个函数求解过程，已知起点位置和终点位置，并且知道道路数据、当前路况数据、历史路况数据，求出最佳行驶路径以及行驶时间。在这个函数求解过程中，需要考虑道路长度、当前拥堵情况，未来拥堵情况等等，会涉及到非常多的算法逻辑。

百度外卖是从百度地图体系下孵化出来的业务，当年独立融资时，对外主打的点就是自身即时配送的高效履约能力，这一点自然离不开其在地图导航上的算法积累。然而后边外卖大战逐渐胶着，真正将配送发展成核心竞争优势的反倒是美团外卖。

美团配送算法负责人何仁清18年曾分享过美团即时配送的算法实践，感兴趣可以参考：《[机器学习在美团配送系统的实践：用技术还原真实世界](https://tech.meituan.com/2018/12/13/machine-learning-in-distribution-practice.html)》

路线规划之后是实时导航，实时导航下很关键的两个服务能力是：定位、诱导。系统需要通过持续定位监听用户行驶轨迹是否在原规划路线上，如偏离过多则会触发重新规划。诱导可分为语音诱导和图片诱导，“前方一百米路口左转”是语音诱导，岔路口展示的车道线示意的图片则是图片诱导。诱导的目的是提前暴露信息，确保用户能及时调整，保证行驶轨迹是按照规划路线进行。

所以，导航的两个过程，路线规划是计算最佳路径，实时导航则是保障最佳路径可以执行，二者的配合构成了整体的导航服务。


### 开放平台

大多数企业需要，但又没有能力搭建地图数据及其关联服务，这就促进了开放平台的发展。

国内的地理位置开放平台主要有百度、高德和腾讯，目前也只有这三家有成熟的地图数据可供使用。三家开放平台提供的服务都大同小异，主要包括：

* 地图展示
* 定位
* 检索
* 路线规划
* 导航

地图展示主要包括样式控制和数据图层的显隐以及POI数据的展示；定位可分为单次定位和持续定位，后者往往伴随着轨迹绘制的需求；检索主要为POI的检索，POI的检索触发时一般需预定义检索区域，这也是各大开发平台支持的行政区域检索、圆形检索和矩形检索的原因。

路线规划会根据载具进行区分，地铁、公交、骑步行和驾车，显然是不同的路线。另外，在路线规划里，ETA也是一个非常重要的信息，这往往要结合路况数据进行计算。

### 商业模式

国内最近十几年的飞速发展，使得地理数据的采集、更新及维护成为一个非常庞大的工作。自行采集维护地理数据的图商虽然被会当作科技公司，但其财务表现往往都有重资产的特征。四维图新是A股的上市公司，其研发投入占比常年排名前列，可见一斑。

早年间地图主要靠提供B端服务盈利，汽车中内置的导航软件是其主要付费来源。电子地图发展到今天，几乎每台智能手机都安装有导航APP，然而地图在C端市场上盈利点依旧很模糊。

百度和高德也在C端商业化做过很多尝试，但到最后基本还是将其定位成一个流量入口，比如车服和O2O。但从19年开始，高德重点发力聚合打车，这是一个平台的雏形，显然比流量入口想象力更大。

但是互联网企业讲究生态，一个不赚钱的生意未必不是一个好生意，有可能只是还没到赚钱的时候。目前能看到的头部互联网公司，基本都在地图能力上有所布局。阿里、腾讯、百度、滴滴、美团也都直接或间接拥有地图采集资质。

地图目前还是一个很垂直的行业，不像推荐、搜索、广告、电商、020 这样的业务容易接触和观察。也因为行业规模较小，地图相关的人才流动也常年在一个低水位。所以对于领域之外的人来讲，地图行业的知识是相对陌生的。这篇文章算是自己工作一年的小小积累，希望能给想了解这个行业的朋友一点微薄的帮助。



注：本文于 2018-09-08 开始撰写，最后更新于 2021-05-17。
