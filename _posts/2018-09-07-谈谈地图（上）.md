---
layout: post
title: 谈谈地图（上）
summary: 关键词：测绘、资质、数据、图层、样式
featured-img: ruben-santander-69158
---
### 关于「地图」

「地图是一种图形表现，它有助于对人类世界中的事物、概念、条件、过程或事件进行空间理解。」

这个定义强调了「地图」是空间理解的媒介。现实世界非常复杂，人类理解过程中往往需要抽象降维。地图是将三维世界地理信息降维成二维世界的点线面元素去理解，降维方法则取决于地理元素在实际生活中的应用。

「圆明园」在现实世界有明确边界和面积，属于区域面（AOI）。但手机搜索圆明园后选择导航到这里，此时「圆明园」会被当作点（POI）来处理，因为只有POI才有明确的坐标，才能作为导航路线的终点。但如果搜索完没有发起导航，地图APP往往会高亮其边界，此时圆明园会被当作一个AOI来展示。

例子中提到的「导航」和「浏览图区」，是地图中最核心的两类使用场景。导航场景下用户关注的是点与点间的路线，目的地如果是AOI面往往会匹配成适配当前驾驶工具的POI点（基本是园区出入口）。浏览图区场景下，点与点间的路线不重要，AOI区域内部的信息相对会更重要。


### 测绘资质


一般把地图上的展示信息分为三类：POI、AOI、道路。其中，POI（Point of interest ）是「点」的概念，AOI（Area of interest）是「面」的概念，道路是「线」的概念，这些数据都需要采集才可得到。 

地理信息采集需要资质，这一点构成了行业最大的护城河。有地理信息采集资质的企业称为「图商」，像高德和四维图新就是老牌的图商。图商将自己采集好的数据加工清洗，向有需要但没能力采集的企业售卖（早期主要是车企），这是早期电子地图的主要商业模式。

随着移动互联网发展，C端开始出现免费的地图导航应用。早年间百度做手机地图时并没有测绘资质，地图数据只能向四维图新购买。

后来四维图新被腾讯投资，高德地图被阿里收购，百度则收购了长地万方。15年-17年，是百度地图收购长地万方后的关键整合时间，也正是这两年，高德地图市占开始反超百度。高德在产品上自然有一些妙手，比如林志玲语音包，但究其根本原因，还是地图数据质量的差异，这几乎决定了这款工具型产品的体验上限。

采集数据需要测绘资质，更新和展示数据也要经过政府审查。一些敏感的POI信息，比如 监狱、精神病院、收留所，是不允许向公众展示的。地图APP会在软件内说明当前地图数据的审图号，这个审图号就是经过政府审查后的合规证明。

除了阿里、腾讯、百度外，华为，滴滴和美团也申请到了测绘资质。华为主要是其无人驾驶业务的需要，滴滴和美团虽然也有无人驾驶规划，但更多的，可能还是数据安全的考虑。

滴滴上每撮合一笔订单，都必然伴随一次路线规划请求。如果路线规划通过第三方来实现，这就意味着需要向第三方暴露每一笔订单的起点、终点和行程轨迹，而这几乎是平台内最核心的数据。

15年百度投资Uber中国，滴滴便由百度地图切换为腾讯地图，到19年，滴滴切换为自己的地图服务，美团也是相似的路径。百度、阿里、腾讯、滴滴、美团，互联网公司申请测绘资质的脚步不会停下，下一个可能是拼多多。


### 数据采集

现实世界不断变化，地理数据也需要不断更新。有一个概念叫「现势性」，在地理数据中用来表征数据更新的时效。与传统测绘相比，手机地图的数据采集会更偏向于道路和POI，这是导航的核心依赖。

数据采集有很多种方法，大致可分为四类：自采、众包、用户上报和渠道合作。

道路数据的采集主要依赖专业采集车，采集车无法行驶的道路，比如景区内部路或狭窄巷道，可以通过步采背包或无人机替代。一辆采集车上会装有多台摄像机和激光设备，行驶时能够实时获取道路的路牌、车道线、边缘线，同时也能拍摄道路两侧的街景。POI便可以从这些街景数据中利用OCR方法来提取。

相比于道路，POI信息的变更会更频繁。一家餐馆新开张试营业几个月后可能就倒闭了，如此短时间的数据变更，依赖街景数据是做不到的。另外，除POI自身外，POI附属信息也会频繁变更，典型的如节假日期间政府部门的办公时间，在国内，这几乎不可能通过规模化的方式采集到。

对于这些空间上离散的、时间上短时效的、需求上个性化的采集需求，一般引入人工来定向解决。在自采车队外，图商还有大量的采集员，他们主要任务是负责这些零散数据的更新。采集员庞大的人力需求催生了地图众包业务的发展。

百度地图和高德地图旗下都有众包采集的产品（名字还都叫淘金），产品逻辑基本都是平台发布POI信息采集任务，用户实地前往验证，按照规定格式采集后可获取激励和报酬。

除自采和众包外，用户上报和渠道合作也是数据获取的重要来源。

用户上报主要面向C端，渠道合作面向B端和G端。C端直接上报的POI数据，置信度无法检验，一般会作为数据缺失情报，不会立即采用。但是对于道路突发事件，比如积水、车祸等，平台可以分析上报位置附近的用户轨迹，来辅助判断其是否置信，置信度高的数据是会被实时采用的。

B端和G端的合作主要是商家（KA客户为主）和各地方政府的交通主管部门。

麦当劳在中国有数千家门店，品牌方希望地图能准确展示其所有门店信息，以便线下获客。地图作为平台方，同时也希望这种高热餐饮POI能够实时准确。这样背景下，二者一般会进行资源置换。除B端外，G端政府合作一般是路况数据的重要来源，部分城市还会开放实时公交数据。高德地图的贴吧里，常年有用户在问某某城市的实时公交什么时候上线，实质上这种服务完全依赖政府数据（爬虫有法务风险），不开放就做不了。

除了上述比较传统的采集方法，互联网公司一般还会采用爬虫和数据挖掘作为信息补充。

爬虫业务逻辑比较简单但需实时对抗，数据挖掘则会有相当多的挖掘策略。淘宝有国内最大的用户订单地址数据和物流信息，美团有最大的餐饮商户的营业信息，这些数据的积累，对POI的更新维护有着非常大的帮助。除此之外，用户移动设备的活动轨迹、wifi连接信息，POI检索行为等等，也都会作为POI情报的挖掘数据源。

高德2020年有一篇文章讲POI现势性维护，详细介绍了基于POI自身信息、用户使用行为、人地关系的POI过期信息挖掘。这是一篇了解地图数据挖掘很好的材料，感兴趣可以阅读：《[高德地理位置兴趣点现势性增强演进之路](https://mp.weixin.qq.com/s/e6htHPENjtO4tWTsmkegCg)》

### 图层与样式

数据格式上，地图数据可分为两种：矢量图和栅格图。矢量图是由若干个线连接的点坐标构成，而栅格图则是通过像素方格来模拟实体。一般系统在存储层面会以矢量图的形式存储，而渲染层面大多会转化为栅格图。栅格图在渲染层面就有图层的概念。

以百度地图为例，地图展示信息会有：AOI、道路、POI、路况线、道路事件等，不同信息展示会有上下层顺序，这也是图层的渲染顺序。道路会展示在AOI上，而路况线则会在道路上，道路事件又会展示在路况线上，这些展示顺序的差异是通过不同图层渲染叠加来实现的。

部分地图数据是基于事件展示的，这样的图层称为「动态图」，比如用户点击或检索后的图区高亮展示，视觉上展示特殊样式用于响应用户的交互动作。和「动态图」概念相对应的是「静态图」，静态图是地理信息本身的呈现，其展示数据和样式不受用户交互行为影响。


不同地理元素在绘制上会呈现不同的视觉效果，如公园展示绿色，餐饮定位为黄色，地图在渲染层面，这些视觉呈现效果被定义为「样式」。

类似于 HTML 定义结构，CSS 定义样式，地图的数据存储和样式展示也是想隔离的。以百度地图为例，其在客户端上支持用户使用个性化地图，比如古风地图、旅游地图等，这些个性化的地图皮肤，实质上就是对应了不同的样式文件（另外也删减了部分底图数据）。

